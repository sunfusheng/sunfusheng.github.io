I"è<p>åˆ†äº«åŠŸèƒ½åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„ï¼Œæœ‰å¯èƒ½æ˜¯åœ¨å±å¹•ä¸­é—´å¼¹å‡ºçš„ Dialog å¯¹è¯æ¡†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä»å±å¹•ä¸‹æ–¹æ»‘ä¸Šæ¥çš„è§†å›¾ã€‚æœ¬æ–‡æ˜¯è‡ªå®šä¹‰ä»å±å¹•ä¸‹æ–¹æ»‘ä¸Šæ¥çš„åˆ†äº«æ§ä»¶ï¼Œå°† ShareView add åˆ° DecorView ä¸Šï¼Œä½†æ˜¯åœ¨å¸¦ NavigationBar å¯¼èˆªæ¡çš„æ‰‹æœºä¸Šå‡ºç°é€‚é…é—®é¢˜ï¼Œä¸‹é¢æ˜¯æˆ‘ç¢°åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•ã€‚</p>

<p><img src="/assets/2016/ok_share_view.png" style="width: 30%;" /></p>

<p>è¿™ä¸ªåŠŸèƒ½å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿè´´ä¸‹ä¸»è¦ä»£ç ï¼ˆ<a href="https://github.com/sunfusheng/In-depthStudy">å…·ä½“å‚è€ƒGitHubä¸Šé¡¹ç›®</a>ï¼‰ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class ShareView {

    private Activity mActivity;
    private View fullMaskView; // è’™å±‚è§†å›¾
    private View contentLayout; // åˆ†äº«è§†å›¾
    private int panelHeight = 0; // åˆ†äº«è§†å›¾é«˜åº¦

    public ShareView(Activity activity) {
        this.mActivity = activity;
        initShareView(activity);
    }

    private void initShareView(Activity activity) {
        fullMaskView = View.inflate(activity, R.layout.ui_view_full_mask_layout, null);
        contentLayout = LayoutInflater.from(activity).inflate(R.layout.ui_share, null);
        ButterKnife.bind(this, contentLayout);

        attachView();
        initListener();
    }

    // å°†è¯¥Viewæ·»åŠ åˆ°æ ¹å¸ƒå±€
    private void attachView() {
        ((ViewGroup) mActivity.getWindow().getDecorView()).addView(fullMaskView);
        FrameLayout.LayoutParams params = new FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT, FrameLayout.LayoutParams.WRAP_CONTENT);
        params.gravity = Gravity.BOTTOM;
        ((ViewGroup) mActivity.getWindow().getDecorView()).addView(contentLayout, params);
        fullMaskView.setVisibility(View.GONE);
        contentLayout.setVisibility(View.GONE);
    }

    // åŠ¨ç”»æ˜¾ç¤ºå¸ƒå±€
    public void show() {
        fullMaskView.setVisibility(View.VISIBLE);
        contentLayout.setVisibility(View.VISIBLE);
        contentLayout.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
            @Override
            public void onGlobalLayout() {
                contentLayout.getViewTreeObserver().removeGlobalOnLayoutListener(this);
                ViewGroup parent = (ViewGroup) contentLayout.getParent();
                panelHeight = parent.getHeight() - contentLayout.getTop();
                ObjectAnimator.ofFloat(contentLayout, "translationY", panelHeight, 0).setDuration(200).start();
            }
        });
    }

    // åŠ¨ç”»éšè—å¸ƒå±€
    public void hide() {
        fullMaskView.setVisibility(View.GONE);
        ObjectAnimator.ofFloat(contentLayout, "translationY", 0, panelHeight).setDuration(200).start();
    } }
</code></pre></div></div>

<p>ä½ è§‰å¾—æœ‰é—®é¢˜å—ï¼Ÿæˆ‘è§‰å¾—æ²¡é—®é¢˜ï¼Œå› ä¸ºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†å‡ ä¸ªç‰ˆæœ¬äº†ï¼Œè¿˜ç»è¿‡æµ‹è¯•çš„ï¼Œè‚¯å®šæ²¡é—®é¢˜ï¼Œä½†æ˜¯çœ‹ä¸‹é¢çš„æ•ˆæœå›¾</p>

<p><img src="/assets/2016/problem_share_view.png" style="width: 30%;" /></p>

<p>ä¸ä»”ç»†çœ‹ä¹Ÿæ²¡æœ‰é—®é¢˜å•Šï¼Œå†çœ‹ä¸‹ï¼Œæ˜¯ä¸æ˜¯â€œå–æ¶ˆâ€æŒ‰é’®æ²¡å•¦ï¼Œæ˜¯ä¸æ˜¯å±å¹•ä¸‹é¢å¤šå‡ºä¸€ä¸ª NavigationBar çš„æ¡ç›®å‘¢ã€‚</p>

<p>so, that`s the problem !</p>

<p>ä¸Šé¢è¿™å¼ å›¾æ˜¯åœ¨åä¸º Nexus æ‰‹æœºä¸Šæˆªçš„å›¾ï¼Œè¿™ä¹ˆä¸€æ¥è¿™ä¸ªè‡ªå®šä¹‰ ShareView åœ¨æ‰€æœ‰å±å¹•åº•ä¸‹å¸¦æœ‰ NavigationBar çš„æ‰‹æœºä¸Š
éƒ½ä¼šæœ‰é—®é¢˜ï¼Œç»è¿‡æµ‹è¯•ï¼Œç¡®å®æ˜¯è¿™æ ·çš„ï¼Œè™½ç„¶å¯¹äºæ•´ä½“åŠŸèƒ½æ²¡æœ‰å¤ªå¤§å½±å“ï¼Œä½†æ˜¯ä»ä¸å¯ä»¥å¿å—ã€‚</p>

<p>æˆ‘ä»¬ä½¿ç”¨çš„å¤§å¤šæ•° Android æ‰‹æœºä¸Šçš„Homeé”®ï¼Œè¿”å›é”®ä»¥åŠmenué”®éƒ½æ˜¯å®ä½“è§¦æ‘¸æ„Ÿåº”æŒ‰é”®ï¼Œä½†æ˜¯ï¼Œä¸€äº›æ‰‹æœºç”Ÿå‚å•†åŒ…æ‹¬ Google åœ¨å†…å®ƒä»¬å¹¶æ²¡æœ‰å®ä½“æŒ‰é”®æˆ–è§¦æ‘¸æ„Ÿåº”æŒ‰é”®ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åœ¨å±å¹•çš„ä¸‹æ–¹åŠ ä¸Š NavigationBar å¯¼èˆªæ¡ï¼Œæˆ‘æ˜¯å¾ˆåç³Ÿè¿™ç§è®¾è®¡çš„ï¼Œè™½ç„¶è¿™ä½¿å¾—æ‰‹æœºå¤–è§‚çš„è®¾è®¡æ›´åŠ ç®€çº¦ã€‚</p>

<p>æ‰¾åˆ°åŸå› å°±æ˜¯æ‰¾åˆ°è§£å†³åŠæ³•äº†ï¼Œå…ˆè·å–æ‰‹æœºæ˜¯å¦æœ‰å¯¼èˆªæ¡ï¼Œæœ‰åˆ™åœ¨æ˜¾ç¤ºå’Œéšè—åŠ¨ç”»çš„æ—¶å€™å¤šåŠ ä¸Šå¯¼èˆªæ¡çš„é«˜åº¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private int navigationBarHeight = 0; // å¯¼èˆªæ é«˜åº¦

// å°†è¯¥Viewæ·»åŠ åˆ°æ ¹å¸ƒå±€
private void attachView() {
    // ...
    if (hasNavigationBar(mActivity)) {
        navigationBarHeight = getNavigationBarHeight(mActivity);
    }
}

// åŠ¨ç”»æ˜¾ç¤ºå¸ƒå±€
public void show() {
    // ...
    ObjectAnimator.ofFloat(contentLayout, "translationY", panelHeight, -navigationBarHeight).setDuration(200).start();
}

// åŠ¨ç”»éšè—å¸ƒå±€
public void hide() {
    // ...
    ObjectAnimator.ofFloat(contentLayout, "translationY", -navigationBarHeight, panelHeight).setDuration(200).start();
}

// åˆ¤æ–­è®¾å¤‡æ˜¯å¦æœ‰è¿”å›é”®ã€èœå•é”®æ¥ç¡®å®šæ˜¯å¦æœ‰ NavigationBar
public static boolean hasNavigationBar(Context context) {
    boolean hasMenuKey = ViewConfiguration.get(context).hasPermanentMenuKey();
    boolean hasBackKey = KeyCharacterMap.deviceHasKey(KeyEvent.KEYCODE_BACK);
    if (!hasMenuKey &amp;&amp; !hasBackKey) {
        return true;
    }
    return false;
}

// è·å– NavigationBar çš„é«˜åº¦
public static int getNavigationBarHeight(Activity activity) {
    Resources resources = activity.getResources();
    int resourceId = resources.getIdentifier("navigation_bar_height", "dimen", "android");
    return resources.getDimensionPixelSize(resourceId);
}
</code></pre></div></div>

<p>è¿™æ ·å°±OKäº†ï¼Œæ•ˆæœå›¾å¦‚ä¸‹</p>

<p><img src="/assets/2016/normal_share_view.png" style="width: 30%;" /></p>

<p><a href="https://github.com/sunfusheng/In-depthStudy">å…·ä½“å‚è€ƒGitHubä¸Šé¡¹ç›®</a></p>

<p>è§£å†³åŠæ³•å‚è€ƒï¼š<a href="http://blog.csdn.net/lnb333666/article/details/41821149">http://blog.csdn.net/lnb333666/article/details/41821149</a></p>

:ET